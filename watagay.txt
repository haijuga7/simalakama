local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local TeleportService = game:GetService("TeleportService")
local Debris = game:GetService("Debris")
local StarterGui = game:GetService("StarterGui")

local LocalPlayer = Players.LocalPlayer
local PlayerGui = LocalPlayer:WaitForChild("PlayerGui")

-- Anti AFK
local VirtualUser = game:GetService("VirtualUser")
Players.LocalPlayer.Idled:Connect(function()
    VirtualUser:CaptureController()
    VirtualUser:ClickButton2(Vector2.new())
    print("[TeleportController] Anti AFK triggered")
end)

-- Daftar posisi teleport (ganti dengan posisi yang Anda inginkan)
local teleportSequence = {
    {pos = Vector3.new(-421.2, 193.4, 556.3), waitTime = 55, notif = "teleport 1 time sleep 60"},
    {pos = Vector3.new(-626.0, 580.8, 1136.1), waitTime = 60, notif = "teleport 2 time sleep 60"},
    {pos = Vector3.new(-901.2, 693.0, 1223.2), waitTime = 65, notif = "teleport 3 time sleep 60"},
    {pos = Vector3.new(-387.0, 1043.1, 2046.2), waitTime = 60, notif = "teleport 4 time sleep 60"},
    {pos = Vector3.new(-754.6, 1527.1, 2059.8), waitTime = 60, notif = "teleport 5 time sleep 60"},
    {pos = Vector3.new(-479.4, 1635.1, 2284.2), waitTime = 15, notif = "teleport 6 time sleep 20"},
    {pos = Vector3.new(-85.3, 1932.1, 2114.2), waitTime = 13, notif = "teleport 7 time sleep 10"},
    {pos = Vector3.new(4.1, 2495.0, 2043.8), waitTime = 4, notif = "telah summit auto respawn akan aktif"}
}

local function playNotificationSound()
    local sound = Instance.new("Sound")
    sound.SoundId = "rbxasset://sounds/electronicpingshort.wav"
    sound.Volume = 3
    sound.Parent = workspace
    sound:Play()
    Debris:AddItem(sound, 2)
end

-- Fungsi menampilkan notifikasi
local function showNotification(title, text, duration)
    StarterGui:SetCore("SendNotification", {
        Title = title or "Notification",
        Text = text or "",
        Duration = duration or 3
    })
end

-- Variabel kontrol
local isTeleporting = false

-- Membuat GUI
local teleportGui = Instance.new("ScreenGui")
teleportGui.Name = "TeleportGUI"
teleportGui.Parent = PlayerGui
teleportGui.ResetOnSpawn = false

-- Frame utama
local mainFrame = Instance.new("Frame")
mainFrame.Size = UDim2.new(0, 200, 0, 120)
mainFrame.Position = UDim2.new(0, 100, 0, 100)
mainFrame.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
mainFrame.BorderSizePixel = 0
mainFrame.Parent = teleportGui

-- Membuat sudut membulat
local corner = Instance.new("UICorner")
corner.CornerRadius = UDim.new(0, 8)
corner.Parent = mainFrame

-- Header untuk drag functionality
local header = Instance.new("Frame")
header.Size = UDim2.new(1, 0, 0, 30)
header.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
header.BorderSizePixel = 0
header.Parent = mainFrame

-- Sudut membulat untuk header
local headerCorner = Instance.new("UICorner")
headerCorner.CornerRadius = UDim.new(0, 8)
headerCorner.Parent = header

-- Judul
local title = Instance.new("TextLabel")
title.Size = UDim2.new(1, 0, 1, 0)
title.BackgroundTransparency = 1
title.Text = "Yagataw Teleport"
title.Font = Enum.Font.GothamBold
title.TextSize = 14
title.TextColor3 = Color3.fromRGB(255, 255, 255)
title.Parent = header

-- Tombol Close GUI
local CloseButton = Instance.new("TextButton")
CloseButton.Size = UDim2.new(0,25,0,25)
CloseButton.Position = UDim2.new(1,-30,0,2.5) -- 30 pixel dari kanan, 2.5 pixel dari atas
CloseButton.BackgroundColor3 = Color3.fromRGB(200,60,60) -- Warna merah
CloseButton.Text = "X"
CloseButton.TextColor3 = Color3.fromRGB(255,255,255) -- Teks putih
CloseButton.Font = Enum.Font.Gotham
CloseButton.TextSize = 12
CloseButton.Parent = header

-- Sudut membulat untuk Tombol Close
local CloseCorner = Instance.new("UICorner")
CloseCorner.CornerRadius = UDim.new(0,12.5)
CloseCorner.Parent = CloseButton

-- Toggle untuk teleport
local toggleFrame = Instance.new("Frame")
toggleFrame.Size = UDim2.new(0.8, 0, 0, 30)
toggleFrame.Position = UDim2.new(0.1, 0, 0, 40)
toggleFrame.BackgroundTransparency = 1
toggleFrame.Parent = mainFrame

local toggleLabel = Instance.new("TextLabel")
toggleLabel.Size = UDim2.new(0.6, 0, 1, 0)
toggleLabel.BackgroundTransparency = 1
toggleLabel.Text = "Auto Teleport:"
toggleLabel.Font = Enum.Font.Gotham
toggleLabel.TextSize = 12
toggleLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
toggleLabel.TextXAlignment = Enum.TextXAlignment.Left
toggleLabel.Parent = toggleFrame

local toggleButton = Instance.new("TextButton")
toggleButton.Size = UDim2.new(0.3, 0, 0.7, 0)
toggleButton.Position = UDim2.new(0.65, 0, 0.15, 0)
toggleButton.BackgroundColor3 = Color3.fromRGB(200, 60, 60)
toggleButton.Text = "OFF"
toggleButton.TextColor3 = Color3.fromRGB(255, 255, 255)
toggleButton.Font = Enum.Font.GothamBold
toggleButton.TextSize = 12
toggleButton.Parent = toggleFrame

local toggleCorner = Instance.new("UICorner")
toggleCorner.CornerRadius = UDim.new(0, 8)
toggleCorner.Parent = toggleButton

-- Tombol Rejoin
local rejoinButton = Instance.new("TextButton")
rejoinButton.Size = UDim2.new(0.8, 0, 0, 30)
rejoinButton.Position = UDim2.new(0.1, 0, 0, 80)
rejoinButton.BackgroundColor3 = Color3.fromRGB(0, 120, 215)
rejoinButton.Text = "Rejoin"
rejoinButton.TextColor3 = Color3.fromRGB(255, 255, 255)
rejoinButton.Font = Enum.Font.GothamBold
rejoinButton.TextSize = 12
rejoinButton.Parent = mainFrame

local rejoinCorner = Instance.new("UICorner")
rejoinCorner.CornerRadius = UDim.new(0, 8)
rejoinCorner.Parent = rejoinButton

-- Fungsi untuk auto respawn
local function autoRespawn()
    LocalPlayer.Character:BreakJoints()
    
    wait(3) -- Tunggu respawn
end

-- Fungsi untuk rejoin
local function rejoinGame()
    game:GetService("TeleportService"):Teleport(game.PlaceId, LocalPlayer)
end

-- Fungsi untuk teleport
local function teleportToPosition(position)
    local character = LocalPlayer.Character
    if character then
        local humanoidRootPart = character:FindFirstChild("HumanoidRootPart")
        if humanoidRootPart then
            humanoidRootPart.CFrame = CFrame.new(position)
        end
    end
end

-- Fungsi utama teleport loop
local function startTeleportLoop()
    isTeleporting = true
    toggleButton.BackgroundColor3 = Color3.fromRGB(60, 200, 60)
    toggleButton.Text = "ON"
    
    while isTeleporting do
        wait(2)
        autoRespawn()

        for _, data in ipairs(teleportSequence) do
            if not isTeleporting then break end
            showNotification("Teleport", data.notif, data.waitTime)
            wait(data.waitTime)
            teleportToPosition(data.pos)
            playNotificationSound()
        end

        if not isTeleporting then break end
        wait(1)
        autoRespawn()
    end
    print("[TeleportController] teleportLoop ended")
end
            
-- Fungsi untuk menghentikan teleport loop
local function stopTeleportLoop()
    isTeleporting = false
    toggleButton.BackgroundColor3 = Color3.fromRGB(200, 60, 60)
    toggleButton.Text = "OFF"
end

-- Toggle button functionality
toggleButton.MouseButton1Click:Connect(function()
    if isTeleporting then
        stopTeleportLoop()
    else
        startTeleportLoop()
    end
end)

-- Rejoin button functionality
rejoinButton.MouseButton1Click:Connect(function()
    rejoinGame()
end)

CloseButton.MouseButton1Click:Connect(function() teleportGui:Destroy() end) -- Tombol Close (menghancurkan GUI)

-- Drag functionality
local dragging = false
local dragInput, dragStart, startPos

local function update(input)
    local delta = input.Position - dragStart
    mainFrame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
end

header.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        dragging = true
        dragStart = input.Position
        startPos = mainFrame.Position
        
        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                dragging = false
            end
        end)
    end
end)

header.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
        dragInput = input
    end
end)

UserInputService.InputChanged:Connect(function(input)
    if input == dragInput and dragging then
        update(input)
    end
end)

-- Cleanup ketika GUI dihapus
teleportGui.AncestryChanged:Connect(function()
    if teleportGui.Parent == nil then
        stopTeleportLoop()
    end
end)
